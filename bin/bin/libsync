#!/bin/bash

LOCAL_PATH="$HOME/papers"
REMOTE_HOST="justinnhli.com"
REMOTE_PATH="/home/justinnhli/justinnhli.com/library"

EXCLUDES=".*"

remote_full_path() {
	filename="$(basename "$1")"
	echo "$REMOTE_PATH/$(echo "${filename:0:1}" | tr 'A-Z' 'a-z')/$filename"
}

if [ $# -eq 0 ]; then
	action='diff'
else
	action="$1"
fi
case "$action" in
	diff)
		local_list="$(cd "$LOCAL_PATH" && find . -name '*.pdf')"
		remote_list="$(ssh dreamhost "cd $REMOTE_PATH && find . -name '*.pdf'")"
		echo 'diff local remote'
		diff <(echo "$local_list" | sort) <(echo "$remote_list" | sort);;
	push)
		rsync --archive --progress --rsh=ssh --exclude "$EXCLUDES" "$LOCAL_PATH/" "$REMOTE_HOST:$REMOTE_PATH";;
	pull)
		rsync --archive --progress --rsh=ssh --exclude "$EXCLUDES" "$REMOTE_HOST:$REMOTE_PATH/" "$LOCAL_PATH";;
	rm)
		ssh "$REMOTE_HOST" "rm -vf $(remote_full_path "$2")";;
	url)
		remote_full_path "$2" | sed 's#.*justinnhli.com#http://justinnhli.com#';;
	*)
		echo "usage: $0 [diff|put|get|rm] [args ...]";;
esac
