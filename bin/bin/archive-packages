#!/bin/bash

case "$1" in
"brew")
	if which brew >/dev/null 2>&1; then
		comm \
			"$HOME/git/dotfiles/packages-meta/.config/packages-meta/brew" \
			<(set-difference <(brew leaves) <(brew cask list))
	else
		echo 'cannot find `brew` command'
		exit 1
	fi;;
"brew-cask")
	if which brew >/dev/null 2>&1; then
		comm \
			"$HOME/git/dotfiles/packages-meta/.config/packages-meta/brew-cask" \
			<(brew cask list)
	else
		echo 'cannot find `brew` command'
		exit 1
	fi;;
"pacaur")
	if which pacaur >/dev/null 2>&1; then
		comm \
			"$HOME/git/dotfiles/packages-meta/.config/packages-meta/pacaur" \
			<(pacman -Qemq)
	else
		echo 'cannot find `pacaur` command'
		exit 1
	fi;;
"pacman")
	if which pacman >/dev/null 2>&1; then
		comm \
			<(sort $HOME/git/dotfiles/packages-meta/.config/packages-meta/pacman) \
			<( \
				( \
					set-difference <(pacman -Qenq) <(pacman -Qgq base base-devel texlive-most | sort | uniq) && \
					echo base-devel && \
					echo texlive-most \
				) | sort
			)
	else
		echo 'cannot find `pacman` command'
		exit 1
	fi;;
"pip")
	comm \
		"$HOME/git/dotfiles/packages-meta/.config/packages-meta/pip" \
		<(python3 -m pip list --not-required --format=freeze | sed 's/=.*//' | sort);;

*)
	echo "$(basename "$0")" "$(grep '^"[a-z-]*")$' "$0" | sort | sed 's/^"\(.*\)")/\1/' | tr '\n' '|' | sed 's/|$//')";;
esac
